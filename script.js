document.addEventListener('DOMContentLoaded',function(){const e=document.querySelector('.hamburger'),t=document.getElementById('menuOverlay'),n=document.querySelector('.close-menu'),a=document.getElementById('settingsBtn'),i=document.getElementById('settingsOverlay'),o=document.querySelector('.close-settings'),s=document.getElementById('addLinkBtn'),d=document.getElementById('addLinkForm'),l=document.getElementById('saveLinkBtn'),c=document.getElementById('linkName'),m=document.getElementById('linkUrl'),u=document.getElementById('menuLinks'),h=document.getElementById('quickLinks'),p=document.getElementById('viewports'),g=document.getElementById('editMenuToggle'),y=document.getElementById('chooseLogoBtn'),v=document.getElementById('logoUpload'),f=document.getElementById('chooseBgBtn'),b=document.getElementById('bgUpload'),w=document.getElementById('logoImg');let x=JSON.parse(localStorage.getItem('customLinks')||'[]'),k=JSON.parse(localStorage.getItem('quickLinks')||'[]'),S=JSON.parse(localStorage.getItem('viewportStates')||'{}'),C=null;function L(){x.forEach(function(e){const t=document.createElement('li');t.innerHTML='<a href="#" data-viewport="'+encodeURIComponent(e.name)+'">'+e.name+'</a>',u.appendChild(t)}),k.forEach(function(e){const t=document.createElement('button');t.textContent=e.name,t.dataset.viewport=encodeURIComponent(e.name),h.appendChild(t)})}function A(){p.innerHTML='',x.forEach(function(e){const t=document.createElement('div');t.className='viewport',t.dataset.viewport=encodeURIComponent(e.name),t.style.width='800px',t.style.height='600px',t.style.top='20px',t.style.left='20px',t.innerHTML='<div class="viewport-header">'+e.name+'</div><iframe class="viewport-content" src="'+e.url+'" frameborder="0"></iframe>',p.appendChild(t),D(t)}),Object.keys(S).forEach(function(e){const t=document.querySelector('.viewport[data-viewport="'+e+'"]');t&&(t.style.top=S[e].top,t.style.left=S[e].left,t.style.width=S[e].width,t.style.height=S[e].height)})}function D(e){const t=e.querySelector('.viewport-header');let n,a,i,o,s=!1;function d(){s=!0,e.classList.add('maximized')}function l(){s=!1,e.classList.remove('maximized')}function c(e){e.preventDefault(),e.stopPropagation()}t.addEventListener('dblclick',function(){s?l():d()});let m=!1,u=0,h=0;t.addEventListener('mousedown',function(e){if(1===e.button&&!s){m=!0,n=e.clientX,a=e.clientY,i=parseInt(e.target.parentElement.style.left)||0,o=parseInt(e.target.parentElement.style.top)||0,e.preventDefault()}});window.addEventListener('mousemove',function(e){if(m&&!s){const t=e.clientX-n,s=e.clientY-a;e.target.parentElement.style.left=i+t+'px',e.target.parentElement.style.top=o+s+'px'}});window.addEventListener('mouseup',function(){if(m&&!s){m=!1;const e=encodeURIComponent(t.parentElement.dataset.viewport);S[e]={top:t.parentElement.style.top,left:t.parentElement.style.left,width:t.parentElement.style.width,height:t.parentElement.style.height},localStorage.setItem('viewportStates',JSON.stringify(S))}});const p=e.querySelector('.viewport-content');p.addEventListener('mousedown',function(e){1===e.button&&(u=e.clientX,h=e.clientY)});let g=1;window.addEventListener('keydown',function(e){68===e.keyCode&&e.altKey&&(e.preventDefault(),(function(){const t=document.querySelectorAll('.viewport'),n=Array.from(t).findIndex(function(e){return e===document.activeElement}),a=(n+1)%t.length;t[a].focus()})()}),p.addEventListener('wheel',function(e){e.altKey?(e.preventDefault(),g+=e.deltaY*-.01,g=Math.min(Math.max(.125,g),4),p.style.transform='scale('+g+')'):p.contentWindow&&p.contentWindow.scrollBy(0,e.deltaY)}),p.addEventListener('mousemove',function(e){if(1===e.buttons&&p.contentWindow){const t=e.clientX-u,n=e.clientY-h;p.contentWindow.scrollBy(-t,-n),u=e.clientX,h=e.clientY}})}function E(){t.classList.add('active')}function T(){t.classList.remove('active')}function I(){i.classList.add('active')}function O(){i.classList.remove('active')}function M(){d.style.display=d.style.display==='flex'?'none':'flex'}function N(){const e=c.value.trim(),t=m.value.trim();if(e&&t){const n={name:e,url:t};x.push(n),localStorage.setItem('customLinks',JSON.stringify(x));const a=document.createElement('li');a.innerHTML='<a href="#" data-viewport="'+encodeURIComponent(e)+'">'+e+'</a>',u.appendChild(a),c.value='',m.value='',d.style.display='none',A()}}function P(e){const t=e.target.closest('a');if(t){e.preventDefault();const n=t.dataset.viewport,a=document.querySelector('.viewport[data-viewport="'+n+'"]');a?(p.querySelectorAll('.viewport').forEach(function(e){e.style.zIndex=1}),a.style.zIndex=2):"dashboard"!==n&&x.some(function(e){return encodeURIComponent(e.name)===n})&&A()}}function j(e){g.checked?u.classList.add('edit-mode'):u.classList.remove('edit-mode')}function R(e){const t=e.target.closest('li');if(t&&g.checked){const n=t.querySelector('a').dataset.viewport;if(e.target.classList.contains('remove-btn')){x=x.filter(function(e){return encodeURIComponent(e.name)!==n}),k=k.filter(function(e){return encodeURIComponent(e.name)!==n}),localStorage.setItem('customLinks',JSON.stringify(x)),localStorage.setItem('quickLinks',JSON.stringify(k)),t.remove();const a=document.querySelector('.viewport[data-viewport="'+n+'"]');a&&a.remove()}else if(e.target.classList.contains('move-btn')){C=t,t.style.opacity='0.4'}}}function B(e){if(C){const t=e.target.closest('li');if(t&&t!==C){t.parentNode.insertBefore(C,t),C.style.opacity='1',C=null}}}function H(){v.click()}function F(){b.click()}function W(e){const t=e.target.files[0];if(t){const e=URL.createObjectURL(t);w.src=e,localStorage.setItem('logo',e)}}function U(e){const t=e.target.files[0];if(t){const e=URL.createObjectURL(t);document.body.style.backgroundImage='url('+e+')',localStorage.setItem('background',e)}}function z(){const e=localStorage.getItem('logo');e&&(w.src=e);const t=localStorage.getItem('background');t&&(document.body.style.backgroundImage='url('+t+')')}e.addEventListener('click',E),n.addEventListener('click',T),a.addEventListener('click',I),o.addEventListener('click',O),s.addEventListener('click',M),l.addEventListener('click',N),u.addEventListener('click',P),g.addEventListener('change',j),u.addEventListener('mousedown',R),u.addEventListener('mouseup',B),u.addEventListener('mouseleave',function(){C&&(C.style.opacity='1',C=null)}),y.addEventListener('click',H),f.addEventListener('click',F),v.addEventListener('change',W),b.addEventListener('change',U),h.addEventListener('click',function(e){const t=e.target.dataset.viewport;if(t){e.preventDefault();const n=document.querySelector('.viewport[data-viewport="'+t+'"]');n&&(p.querySelectorAll('.viewport').forEach(function(e){e.style.zIndex=1}),n.style.zIndex=2)}}),z(),L(),A()});
